
sudo: required
language: bash

env:
  global:
    - ARG_MUSICBOT_VERSION=1.9.7
  matrix:
    - ARG_ARCHITECTURE=x86_64

services:
  - docker

before_install:
  - > 
    if [ "$ARG_ARCHITECTURE" == "x86_64" ]; then
      TAG_LATEST=latest
      TAG_VERSION=$ARG_MUSICBOT_VERSION
    else
      TAG_LATEST=$ARG_ARCHITECTURE-latest
      TAG_VERSION=$ARG_ARCHITECTURE-$ARG_MUSICBOT_VERSION
    fi

install:
  - docker build -t glego/musicbot:$TAG_LATEST -t glego/musicbot:$TAG_VERSION --build-arg ARG_MUSICBOT_VERSION=$ARG_MUSICBOT_VERSION -f ./dockerfiles/ubuntu-16.04/x86_64/Dockerfile . 

script:
  - docker images -a

after_success:
  - >
    if [ "$TRAVIS_BRANCH" == "master" ]; then
      docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
      docker push glego/musicbot:$TAG_VERSION
    fi